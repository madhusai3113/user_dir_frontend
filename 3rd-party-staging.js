!function(){if(window.hasOwnProperty("BlueshiftConnect"))return!1;var t=null,e="undefined"!=typeof _BLUESHIFT_ROOT?_BLUESHIFT_ROOT:"https://blueshift-staging.quantinsti.com",n="https://di206pkbrwro2.cloudfront.net/static-assets-prod/3rd-party-integration",i="https://di206pkbrwro2.cloudfront.net/static-assets-prod/3rd-party-integration/blueshift-3rd-party-prod-v4-minified.css",s=["action","name","templateType","isFolder","editorType","backtestBundleName","backtestEndDate","backtestStartDate","backtestStartCapital","strategyLink","link","buttonSize","buttonTheme","pwdPath","entryPwdPath","templateEntryFile"],a=["buttonSize","buttonTheme"],o=!1;function c(t,e=!1){let n=e?t:`https://blueshift-staging.quantinsti.com/accounts?redirect=${encodeURIComponent(t)}`;window.open(n)}function r(t){return d(t)}function l(t){return d(t)}function d(t){return e+"/research/strategies"+function t(e,n=a){let i="",s=[];return e&&(Object.keys(e).forEach(function(t){if(-1!==n.indexOf(t))return;let i=encodeURIComponent(e[t]);if(i&&"undefined"!==i){var a=t+"="+encodeURIComponent(e[t]);s.push(a)}}),i="?"+s.join("&")),i}(t)}function u(){t("*[data-blueshift]").each(function(e,n){if(!(n=t(n)).data("blueshift-converted")){n.data("blueshift-converted",1);for(var i={},a=0;a<s.length;a+=1)i[s[a]]=n.data(s[a]);(blueshift=new BlueshiftConnect(i)).generateBlueshiftLink(),console.log("base obj",blueshift.url),"BLUESHIFT-CONNECT-BUTTON"==n.prop("tagName").toUpperCase()&&(blueshift.renderButton(n),blueshift.link(n)),"BLUESHIFT-WIDGET"==n.prop("tagName").toUpperCase()&&(blueshift.renderWidget(n),blueshift.link(n))}})}function h(e){(t=e)(document).ready(function(){u(),t(document).bind("DOMNodeInserted",function(e){t(e.target).data("blueshift")&&u()})}),o=!0}window.BlueshiftConnect=function(e){var s=null;let a=this;this.generateBlueshiftLink=function(){var t,n;switch(e.action){case"go-live":s=d(t=e);return;case"backtest":s=d(n=e);return;case"backtest-widget":s=e.link;return;default:alert("No action defined")}},this.link=function(e){"string"==typeof e&&(e=t(e)),e&&"object"==typeof e&&e.click(function(e){return e.preventDefault(),t(this).blur(),c(s),!1})},this.renderButton=function(o){if("string"==typeof o&&(o=t(o)),!o||"object"!=typeof o)return;let r="light"===e.buttonTheme?`${n}/blueshift-logo-white.svg`:`${n}/blueshift-logo-black.svg`,l=`blueshift-${e.action} button-${e.buttonTheme} button-${e.buttonSize}`,d="go-live"===e.action?"Live Trade":"Backtest",u="button-"+new Date().getTime().toString(),h=`<iframe id=${u} frameborder="0" allowfullscreen="true" style="width: 150px; height: 70px;"></iframe>`;o.html(h),a.link(o),document.querySelector("#"+u).contentDocument.write(`<html><head><meta content="width=device-width, initial-scale=1" name="viewport" /><link rel="stylesheet" href="${i}"></head><body id="happy" style="margin: 0px"><div  class="${l}"></script><img src="${r}"><span>${d}</span><div class="button-spon">Powered by Blueshift</div></div></body></html>`),document.querySelector("#"+u).contentWindow.document.body.onclick=function(){c(s)}},this.renderWidget=function(e){if("string"==typeof e&&(e=t(e)),e&&"object"==typeof e){var a,o,r,l,d="GET";a=function t(e){try{let n=new URL(e).pathname.split("/");return`https://bs-poc.quantinsti.com/research/api/share/${n[n.length-1]}`}catch(i){console.log(i);return}}(s),o=function(a){let o=Math.round(100*(a=JSON.parse(a)).returns,2),r=parseInt(100*a.sharpe)/100,l=a.drawdown?`${(100*a.drawdown).toFixed(2)} %`:"-",d="widget-"+new Date().getTime().toString(),u=t(window).width(),h="380px";u>600?u="430px":(u="100%",h="420px");let f=`<iframe id=${d} frameborder="0" scrolling="no" style="width: ${u}; height: ${h}"></iframe>`;e.html(f);let p=`<html><head><link rel="stylesheet" href="${i}"></head><body style="margin:0px"><div class="blueshift-connect-widget-wrapper"><div class="blueshift-connect-widget-header"><div class="main-ins"><p class="blueshift-connect-details-font">${o}%</p><p class="blueshift-connect-caption-font">Total Returns</p></div><div class="main-ins"><p class="blueshift-connect-details-font blueshift-connect-align-center">${r}</p><p class="blueshift-connect-caption-font blueshift-connect-align-center">Sharpe Ratio</p></div><div class="main-ins"><p class="blueshift-connect-details-font blueshift-connect-align-center ">${l}</p><p class="blueshift-connect-caption-font blueshift-connect-align-center ">Drawdown</p></div><div class="main-ins blueshift-connect-align-right"><img src="${n}/expand.svg"></div></div><div class="blueshift-connect-widget-image"><img src="${a.backtestImage}"></div><div class="blueshift-connect-widget-bottom"><div class="blueshift-connect-main-ins-bottom"><div class="square blueshift-connect-benchmark"></div><div class="blueshift-connect-caption-font">Benchmark</div></div><div class="blueshift-connect-main-ins-bottom"><div class="square strategy"></div><div class="blueshift-connect-caption-font">Portfolio Value</div></div><div class="blueshift-connect-main-ins-bottom"><div class="blueshift-connect-caption-font blueshift-connect-power-bs"><span class="pow-blueshift">Powered by</span><img src="${n}/../blueshift-logo.svg" alt="Blueshift Logo" class="blueshift-connect-blueshift-icon"></div></div></div></body></html>`;document.querySelector("#"+d).contentDocument.write(p),document.querySelector("#"+d).contentWindow.document.body.onclick=function(){c(s,!0)}},l=new XMLHttpRequest,l.onreadystatechange=function(){4==l.readyState&&o&&o(l.response)},l.withCredentials=!0,l.open("GET",a,!0),r?(l.setRequestHeader("Content-Type","application/json;charset=UTF-8"),l.send(JSON.stringify(r))):l.send(null)}}};var f=!0;if(window.hasOwnProperty("jQuery")&&jQuery.hasOwnProperty("fn")&&jQuery.fn.hasOwnProperty("jquery")){var p=parseFloat(jQuery.fn.jquery);!isNaN(p)&&p>=1.6&&(f=!1,h(jQuery))}if(f){var b=document.createElement("script");b.src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js";var g=document.getElementsByTagName("head")[0],m=!1;b.onload=b.onreadystatechange=function(){m||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(m=!0,h(jQuery),b.onload=b.onreadystatechange=null,g.removeChild(b))},g.appendChild(b)}}();
